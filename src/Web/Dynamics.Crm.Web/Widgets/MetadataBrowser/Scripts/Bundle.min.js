var Validation,Dynamics,MetadataBrower;(function(n){var t;(function(t){var i;(function(i){"use strict";function r(){i.log=new e}function o(){i.log=new f}function s(){for(var t,i=[],n=0;n<arguments.length;n++)i[+n]=arguments[n];for(console.log("Function "+arguments[0]+" called with arguments: {"),t=1;t<arguments.length;t++)console.log(arguments[t]);console.log("}")}function u(i,r){var f=h(),e=c(),o=l(),s=v(),y=a(),p=r.stack||r.stacktrace||"<none>",w=r.description||"<none>",b="JavaScript::"+s+","+y+","+o+":"+f+"("+e+")",k="Stack: "+p+"\nDescription: "+w,u={type:t.Data.Schema.LogEntryEntity.type},d=r.type?r.type+":"+i:i,g=i===r.message?i:(i+". "+r.message).trim();return u[t.Data.Schema.LogEntryEntity.nameField]=Validation.Strings.left(d,300),u[t.Data.Schema.LogEntryEntity.messageField]=Validation.Strings.left(g,5e3),u[t.Data.Schema.LogEntryEntity.descriptionField]=Validation.Strings.right(k,1048576),u[t.Data.Schema.LogEntryEntity.sourceField]=Validation.Strings.left(b,500),u[t.Data.Schema.LogEntryEntity.typeField]=n.Crm.Core.LogEntryType.Error,u}function h(){try{return Xrm.Page.data.entity.getEntityName()}catch(n){return i.trace&&i.log&&i.log.Warning(n),"UnknownEntity"}}function c(){try{return Xrm.Page.data.entity.getId()}catch(n){return i.trace&&i.log&&i.log.Warning(n),""}}function l(){try{return Xrm.Page.ui.getFormType().toString()}catch(n){return i.trace&&i.log&&i.log.Warning(n),""}}function a(){try{return t.Forms.getFormFactor()}catch(n){return i.trace&&i.log&&i.log.Warning(n),-1}}function v(){try{return t.Forms.getClientType()}catch(n){return i.trace&&i.log&&i.log.Warning(n),"unknown"}}i.debug=!0;i.trace=!0;var f=function(){function n(){}return n.prototype.Error=function(n,t){i.debug;var r=u(n,t);console.error(r)},n.prototype.Message=function(n){console.log(n)},n.prototype.Warning=function(n){console.warn(n)},n}(),e=function(){function t(){}return t.prototype.Error=function(t,r){i.debug;var f=u(t,r);console.error(f);n.Crm.Data.unitOfWork.GetLogEntryRepository().Create(f)},t.prototype.Message=function(n){console.log(n)},t.prototype.Warning=function(n){console.warn(n)},t}();i.useLogEntryLogger=r;i.useConsoleLogger=o;i.printArguments=s;r()})(i=t.Diagnostics||(t.Diagnostics={}))})(t=n.Crm||(n.Crm={}))})(Dynamics||(Dynamics={})),function(n){"use strict";function t(n,t){if(n===undefined||n===null)throw new Error(Resources.Strings.NullArgumentMessageFormat(t));}function i(n,t){if(n===undefined||n===null)throw new Error(Resources.Strings.NullArgumentMessageFormat(t));if(!_.isString(n))throw new Error(Resources.Strings.InvalidTypeMessageFormat("string",typeof n));if(n==="")throw new Error(Resources.Strings.NullArgumentMessageFormat(t));}function r(n,t,i,r){if(t===void 0&&(t=null),i===void 0&&(i=null),r===void 0&&(r=null),!_.isNumber(n))throw new Error(Resources.Strings.InvalidTypeMessageFormat("number",typeof n));if(_.isNumber(t)&&n<t)throw new Error(Resources.Strings.OutOfRangeMessageFormat(r));if(_.isNumber(i)&&n>i)throw new Error(Resources.Strings.OutOfRangeMessageFormat(r));}n.ensureNotNullOrUndefined=t;n.ensureNotNullOrEmpty=i;n.ensureNumberInRange=r}(Validation||(Validation={})),function(n){var t;(function(t){"use strict";function i(t,i){return(n.ensureNumberInRange(i,0),t===null||t===undefined)?t:t.length<=i?t:t.substr(0,i)}function r(t,i){return(n.ensureNumberInRange(i,0),t===null||t===undefined)?t:t.length<=i?t:t.substr(t.length-i,i)}t.left=i;t.right=r})(t=n.Strings||(n.Strings={}))}(Validation||(Validation={})),function(n){var t;(function(n){var t;(function(t){"use strict";function i(){var n;if(typeof Xrm!="undefined"&&typeof Xrm.Page!="undefined"&&typeof Xrm.Page.context!="undefined"?n=Xrm.Page.context:typeof GetGlobalContext!="undefined"&&(n=GetGlobalContext()),!n)throw new Error("Unable to resolve CRM Global Context.");return n}function r(){var t=i().getVersion();if(t===undefined)return n.Diagnostics.log.Warning("getContext().getVersion() is undefined"),"v8.0";if(t>="8.2")return"v8.2";if(t>="8.1")return"v8.1";if(t>="8.0")return"v8.0";throw new Error("Version not supported: {version}.".replace("{version}",t));}function e(n){return n+"id"}function u(n,t,i){if(!i)return null;var r=e(n),u={id:i[r],type:n};return t.forEach(function(n){if(n!==r){var t=i[n];t!==undefined&&(u[n]=t)}}),u}function o(n){var t={};return Object.keys(n).forEach(function(i){i!=="id"&&i!=="type"&&(t[i]=n[i])}),JSON.stringify(t)}function c(t,f,e,o,s){Validation.ensureNotNullOrEmpty(t,"entityName");Validation.ensureNotNullOrEmpty(f,"entitySetName");Validation.ensureNotNullOrEmpty(e,"entityId");var c=i().getClientUrl(),h=c+"/api/data/"+r()+"/"+f+"("+n.Core.parseIdentifier(e)+")?$select="+o.join(",");return s&&(h+="&$expand="+s.join(",")),$.ajax({url:h,dataType:"json"}).then(function(n){return u(t,o,n)}).fail(function(t){t&&t.responseJSON&&t.responseJSON.error&&n.Diagnostics.log.Error(t.responseJSON.error.message+" retrieve "+h,t.responseJSON.error.innererror||t.responseJSON.error)})}function l(t,e,o,s,h,c,l){h===void 0&&(h=null);c===void 0&&(c=null);l===void 0&&(l=null);Validation.ensureNotNullOrEmpty(t,"entityName");Validation.ensureNotNullOrEmpty(e,"entitySetName");var v=i().getClientUrl(),y=!h||h===f.And?" and ":" or ",a=v+"/api/data/"+r()+"/"+e+"?$select="+o.join(",")+"&$filter="+s.join(y);return c&&(a+="&$orderby="+c.join(",")),l&&(a+="&$expand="+l.join(",")),$.ajax({url:a,dataType:"json"}).then(function(n){var i=n.value;return i.map(function(n){return u(t,o,n)})}).fail(function(t){t&&t.responseJSON&&t.responseJSON.error&&n.Diagnostics.log.Error(t.responseJSON.error.message+" retrieve multiple "+a,t.responseJSON.error.innererror||t.responseJSON.error)})}function a(t,u,f){Validation.ensureNotNullOrEmpty(t,"entityName");Validation.ensureNotNullOrEmpty(u,"entitySetName");Validation.ensureNotNullOrEmpty(f,"entityId");var o=i().getClientUrl(),e=o+"/api/data/"+r()+"/"+u+"("+n.Core.parseIdentifier(f)+")";return $.ajax({url:e,dataType:"json",type:"DELETE"}).fail(function(t){t&&t.responseJSON&&t.responseJSON.error&&n.Diagnostics.log.Error(t.responseJSON.error.message+" delete "+e,t.responseJSON.error.innererror||t.responseJSON.error)})}function v(t,f,s){var l,h,c,a;return s===void 0&&(s=null),Validation.ensureNotNullOrUndefined(t,"entity"),Validation.ensureNotNullOrEmpty(f,"entitySetName"),l=i().getClientUrl(),h=e(t.type),s=s||[],s.indexOf(h)<0&&s.push(h),c=l+"/api/data/"+r()+"/"+f+"?$select="+s.join(","),a=o(t),$.ajax({url:c,contentType:"application/json; charset=utf-8",dataType:"json",type:"POST",data:a,headers:{Prefer:"return=representation"}}).then(function(n){return u(t.type,s,n)}).fail(function(t){t&&t.responseJSON&&t.responseJSON.error&&n.Diagnostics.log.Error(t.responseJSON.error.message+" create "+c,t.responseJSON.error.innererror||t.responseJSON.error)})}function y(t,u){Validation.ensureNotNullOrUndefined(t,"entity");Validation.ensureNotNullOrEmpty(u,"entitySetName");var e=i().getClientUrl(),f=e+"/api/data/"+r()+"/"+u+"("+n.Core.parseIdentifier(t.id)+")",s=o(t);return $.ajax({url:f,contentType:"application/json; charset=utf-8",dataType:"json",type:"PATCH",data:s}).fail(function(t){t&&t.responseJSON&&t.responseJSON.error&&n.Diagnostics.log.Error(t.responseJSON.error.message+" update "+f,t.responseJSON.error.innererror||t.responseJSON.error)})}function p(t,u){var e=i().getClientUrl(),f=e+"/api/data/"+r()+"/"+t+"?fetchXml="+encodeURIComponent(u);return $.ajax({url:f,dataType:"json"}).fail(function(t){t&&t.responseJSON&&t.responseJSON.error&&n.Diagnostics.log.Error(t.responseJSON.error.message+" create "+f,t.responseJSON.error.innererror||t.responseJSON.error)})}function w(n){n===void 0&&(n=s);var t=i().getClientUrl(),u=t+"/api/data/"+r()+"/EntityDefinitions?$select="+n.join(",");return $.ajax({url:u,dataType:"json"}).then(function(n){return n?n.value:[]})}function b(n,t){t===void 0&&(t=h);Validation.ensureNotNullOrEmpty(n,"metadataId");var u=i().getClientUrl(),f=u+"/api/data/"+r()+"/EntityDefinitions("+n+")/Attributes?$select="+t.join(",");return $.ajax({url:f,dataType:"json"}).then(function(n){return n.value})}function k(n,t){Validation.ensureNotNullOrEmpty(n,"metadataId");Validation.ensureNotNullOrEmpty(t,"attributeMetadataId");var r=i().getClientUrl(),u=r+"/api/data/v8.0/EntityDefinitions("+n+")/Attributes("+t+")/Microsoft.Dynamics.CRM.PicklistAttributeMetadata/OptionSet?$select=Options";return $.ajax({url:u,dataType:"json"}).then(function(n){return n?n.Options:[]})}var f,s,h;(function(n){n[n.And=1]="And";n[n.Or=2]="Or"})(t.FilterType||(t.FilterType={}));f=t.FilterType;t.retrieve=c;t.retrieveMultiple=l;t.deleteEntity=a;t.createEntity=v;t.updateEntity=y;t.fetch=p;s=["MetadataId","DisplayName","LogicalName","ObjectTypeCode","SchemaName"];t.entityDefinitions=w;h=["MetadataId","DisplayName","LogicalName","AttributeType","Description"];t.entityAttributesDefinition=b;t.entityAttributeOptionSetDefinition=k})(t=n.OData||(n.OData={}))})(t=n.Crm||(n.Crm={}))}(Dynamics||(Dynamics={})),function(n){var t;(function(n){"use strict";function t(){angular.bootstrap(document,[n.moduleName])}n.moduleName="metadata-browser";angular.module(n.moduleName,["ngMaterial","ngMessages"]);angular.element(document).ready(t)})(t=n.Config||(n.Config={}))}(MetadataBrower||(MetadataBrower={})),function(n){var t;(function(){"use strict";function i(){return new t}var t=function(){function n(){this.EntityTabs=[]}return n.prototype.AddEntityTab=function(n){var t=this.EntityTabs.filter(function(t){return t.entity.LogicalName===n.LogicalName});t.length>0?this.SelectedIndex=this.EntityTabs.indexOf(t[0])+1:(this.EntityTabs.push({entity:n,title:n.SchemaName}),this.SelectedIndex=this.EntityTabs.length)},n.prototype.DeleteEntityTab=function(n){_.remove(this.EntityTabs,function(t){return t.entity.LogicalName===n.entity.LogicalName})},n}();angular.module(n.Config.moduleName).factory("metadataBrowser.core.navigationService",[i])})(t=n.Core||(n.Core={}))}(MetadataBrower||(MetadataBrower={})),function(n){var t;(function(){"use strict";function i(n){return new t(n)}var t=function(){function n(n){this._$q=n}return n.prototype.GetEntities=function(){var n=this._$q.defer();return Dynamics.Crm.OData.entityDefinitions().done(function(t){n.resolve(t)}).fail(function(){n.reject()}),n.promise},n.prototype.GetAttributes=function(n){var t=this._$q.defer();return Dynamics.Crm.OData.entityAttributesDefinition(n.MetadataId).done(function(n){t.resolve(n)}).fail(function(){t.reject()}),t.promise},n.prototype.GetOptionSets=function(n,t){var i=this._$q.defer();return Dynamics.Crm.OData.entityAttributeOptionSetDefinition(n.MetadataId,t.MetadataId).done(function(n){i.resolve(n)}).fail(function(){i.reject()}),i.promise},n}();angular.module(n.Config.moduleName).factory("metadataBrowser.core.dataService",["$q",i])})(t=n.Core||(n.Core={}))}(MetadataBrower||(MetadataBrower={})),function(n){var t;(function(){"use strict";function t(){return{controller:i,restrict:"E",scope:{entity:"="},templateUrl:"templates/entity_details.html"}}var i=function(){function n(n,t){this._dataService=t;n.vm={advancedView:!1,attributes:[],currentPage:1,entity:n.entity,entityAttributes:[],isBusy:!1,filter:"",pageSize:20,total:0};n.clear=this.clear.bind(this);n.search=this.search.bind(this);n.export=this.export.bind(this);this.vm=n.vm;this.loadEntityMetadata();n.$watch("vm.currentPage",this.filterAttributes.bind(this))}return n.prototype.clear=function(){this.vm.currentPage=1;this.vm.filter="";this.showAttributes()},n.prototype.export=function(){console.warn("Not implemented")},n.prototype.filterAttributes=function(){var n=this.vm.filter,t=this.vm.entityAttributes.filter(function(t){return t.LogicalName.indexOf(n)>=0});this.showAttributes(t)},n.prototype.loadEntityMetadata=function(){var n=this;return this.vm.isBusy=!0,this._dataService.GetAttributes(this.vm.entity).then(function(t){n.vm.entityAttributes=t.sort(function(n,t){return n.LogicalName<t.LogicalName?-1:n.LogicalName>t.LogicalName?1:0});n.showAttributes()}.bind(this)).finally(this.loadEntityMetadataCompleted.bind(this))},n.prototype.loadEntityMetadataCompleted=function(){this.vm.isBusy=!1},n.prototype.search=function(){this.vm.currentPage=1;this.filterAttributes()},n.prototype.showAttributes=function(n){n=n||this.vm.entityAttributes;var t=this.vm.pageSize,i=(this.vm.currentPage-1)*t;this.vm.total=n.length;this.vm.attributes=n.filter(function(n,r){return r>=i&&r<i+t})},n.$inject=["$scope","metadataBrowser.core.dataService"],n}();angular.module(n.Config.moduleName).directive("entityDetails",t)})(t=n.Controller||(n.Controller={}))}(MetadataBrower||(MetadataBrower={})),function(n){var t;(function(){"use strict";function t(){return{controller:i,restrict:"E",scope:{currentPage:"=",pageSize:"=",total:"="},template:'<span class="pager">\n    <span ng-bind="currentPage"><\/span> of <span ng-bind="pages"><\/span>\n    <md-button ng-click="prev()">Prev<\/md-button>\n    <md-button ng-click="next()">Next<\/md-button>\n<\/span>'}}var i=function(){function n(n){this._scope=n;this._scope.$watch("total",this.updatePages.bind(this));this._scope.$watch("pageSize",this.updatePages.bind(this));this._scope.next=this.next.bind(this);this._scope.prev=this.prev.bind(this)}return n.prototype.updatePages=function(){this._scope.pageSize===0&&(this._scope.pageSize=10);this._scope.pages=Math.ceil(this._scope.total/this._scope.pageSize)},n.prototype.next=function(){this._scope.currentPage>=this._scope.pages||this._scope.currentPage++},n.prototype.prev=function(){this._scope.currentPage<=1||this._scope.currentPage--},n.$inject=["$scope"],n}();angular.module(n.Config.moduleName).directive("pager",t)})(t=n.Controllers||(n.Controllers={}))}(MetadataBrower||(MetadataBrower={})),function(n){var t;(function(){"use strict";function t(){return{controller:i,restrict:"E",scope:{entity:"=",attribute:"="},template:'\n<a href="javascript:void(0);" class="picklist-toggle" ng-click="load()">+\n    <md-tooltip md-direction="right" class="picklist">\n        <span ng-if="!options">Click to load options<\/span>\n        <span ng-if="options && !options.length">Loading...<\/span>\n        <ul class="options" ng-if="options && options.length">\n            <li class="option" ng-repeat="option in options">\n                <span ng-bind="option.Label.UserLocalizedLabel.Label"><\/span>\n                <span ng-if="option.Value !== null">&nbsp;=&nbsp;<\/span>\n                <span ng-bind="option.Value"><\/span>\n            <\/li>\n        <\/ul>\n    <\/md-tooltip>\n<\/a>'}}var i=function(){function n(n,t){n.load=function(){n.options||(n.options=[],t.GetOptionSets(n.entity,n.attribute).then(function(t){n.options=t;n.options.length||n.options.push({Label:{UserLocalizedLabel:{Label:"No values"}},Value:null})}).catch(function(){n.options=null}))}}return n.$inject=["$scope","metadataBrowser.core.dataService"],n}();angular.module(n.Config.moduleName).directive("picklist",t)})(t=n.Controllers||(n.Controllers={}))}(MetadataBrower||(MetadataBrower={})),function(n){var t;(function(){"use strict";function t(){return{restrict:"E",scope:{object:"="},templateUrl:"templates/property_browser.html"}}angular.module(n.Config.moduleName).directive("propertyBrowser",t)})(t=n.Controllers||(n.Controllers={}))}(MetadataBrower||(MetadataBrower={})),function(n){var t;(function(){"use strict";var t=function(){function n(n,t,i){this.advancedView=!1;this.currentPage=1;this.entities=[];this.entitiesToShow=[];this.filter="";this.isBusy=!1;this.pageSize=20;this.total=0;this.navigationService=t;this.dataService=i;n.$watch("vm.currentPage",this.filterEntities.bind(this));this.loadEntities()}return n.prototype.clear=function(){this.currentPage=1;this.filter="";this.showEntities()},n.prototype.exportToCsv=function(){console.warn("Not implemented")},n.prototype.filterEntities=function(){var n=this.filter,t=this.entities.filter(function(t){return t.LogicalName.indexOf(n)>=0});this.showEntities(t)},n.prototype.loadEntities=function(){var n=this;this.currentPage=1;this.entities=[];this.entitiesToShow=[];this.filter="";this.total=0;this.isBusy=!0;this.dataService.GetEntities().then(function(t){n.entities=t.sort(function(n,t){return n.LogicalName<t.LogicalName?-1:n.LogicalName>t.LogicalName?1:0});n.showEntities()}.bind(this)).finally(this.loadEntitiesCompleted.bind(this))},n.prototype.loadEntitiesCompleted=function(){this.isBusy=!1},n.prototype.showEntities=function(n){n=n||this.entities;var t=this.pageSize,i=(this.currentPage-1)*t;this.total=n.length;this.entitiesToShow=n.filter(function(n,r){return r>=i&&r<i+t})},n.prototype.openEntity=function(n){this.navigationService.AddEntityTab(n)},n.prototype.search=function(){this.currentPage=1;this.filterEntities()},n.$inject=["$scope","metadataBrowser.core.navigationService","metadataBrowser.core.dataService"],n}();angular.module(n.Config.moduleName).controller("metadataBrowser.ui.controllers.entityList",t)})(t=n.Controllers||(n.Controllers={}))}(MetadataBrower||(MetadataBrower={})),function(n){var t;(function(){"use strict";var t=function(){function n(n){var t=this;t.navigationService=n}return n.$inject=["metadataBrowser.core.navigationService"],n}();angular.module(n.Config.moduleName).controller("metadataBrowser.ui.controllers.crmMetadataBrowser",t)})(t=n.Controllers||(n.Controllers={}))}(MetadataBrower||(MetadataBrower={}));